# TaskPixel修改方案

根据您的需求，我为TaskPixel应用设计了以下修改方案，包括三个主要功能的实现：
1. 为目标和子目标添加删除和修改功能
2. 修改AI辅助生成方式，使其基于用户描述的当前事件或困难
3. 改进AI评估优先级功能，使用问卷选择题方式收集用户反馈后评估

## 一、目标和子目标的删除与修改功能

### 1. 目标的修改与删除

在任务详情页中，为每个目标添加编辑和删除按钮，实现以下功能：

- **修改目标**：点击编辑按钮打开修改对话框，允许用户修改目标标题和描述
- **删除目标**：点击删除按钮后确认删除，从任务中移除目标及其所有子步骤

需要修改的文件：
- `taskDetail.js`：添加修改和删除目标的UI元素、事件处理和逻辑实现
- `task_detail.html`：确保界面支持新增的按钮和对话框

### 2. 子步骤的修改与删除

在每个子步骤旁边添加编辑和删除按钮，实现以下功能：

- **修改子步骤**：点击编辑按钮打开修改对话框，允许用户修改子步骤内容
- **删除子步骤**：点击删除按钮后确认删除，从目标中移除该子步骤

需要修改的文件：
- `taskDetail.js`：添加修改和删除子步骤的UI元素、事件处理和逻辑实现

### 3. 数据存储层扩展

在数据存储模块中添加新的方法支持修改和删除操作：

- `updateGoal`：更新目标信息
- `deleteGoal`：删除目标
- `updateSubstep`：更新子步骤内容
- `deleteSubstep`：删除子步骤

需要修改的文件：
- `core.js`：扩展DataStore模块添加上述方法

## 二、基于用户描述的AI辅助生成功能

### 1. 用户输入对话框

创建一个新的对话框，让用户描述当前事件或困难：

- 当用户点击"AI生成目标"时，不直接使用任务标题和描述
- 而是先打开对话框让用户输入当前遇到的事件或困难描述

需要修改的文件：
- `taskDetail.js`：修改generateGoalsWithAI方法
- 添加用户输入对话框的HTML和交互逻辑

### 2. 修改AI提示词

重新设计AI提示词模板，使用用户输入的描述作为主要上下文：

- 更新`aiAssist.js`中的提示词模板
- 保留任务标题和描述作为背景上下文，但将用户输入的描述作为主要考虑因素

需要修改的文件：
- `aiAssist.js`：修改generateGoalsAndSubsteps方法的参数和提示词

## 三、基于问卷选择题的AI优先级评估功能

### 1. 设计评估流程

新的AI优先级评估流程将包含以下步骤：

1. 用户点击"AI评估优先级"按钮
2. 系统分析当前目标的指标和子步骤难度
3. 生成3-5个相关的选择题问卷
4. 用户回答问卷选择题
5. 基于用户的回答，AI分析并给出优先级评估结果

### 2. 问卷生成功能

开发问卷生成功能，主要包括：

- **问题生成**：AI根据目标内容和子步骤生成相关问题
- **选项生成**：为每个问题提供2-4个选项
- **问卷呈现**：设计用户友好的问卷界面
- **答案收集**：记录用户的选择

需要修改的文件：
- `aiAssist.js`：添加生成评估问卷的方法
- `taskDetail.js`：添加显示问卷和收集回答的UI交互

### 3. 问卷内容设计

问卷将围绕以下几个方面设计问题：

- **紧急性**：目标的时间紧迫程度
- **重要性**：目标对整体任务的影响程度
- **复杂度**：完成目标的技术难度
- **资源需求**：完成目标所需的时间和资源
- **依赖关系**：与其他目标的前后依赖关系

每个问题将提供多个选项，用户选择最符合当前情况的选项。

### 4. 优先级评估算法

基于用户的问卷回答，使用加权算法计算优先级：

- 分析用户回答的模式
- 识别关键因素（如高紧急性或高重要性）
- 综合评估生成优先级结果（高、中、低）
- 提供评估理由说明

### 5. 结果展示优化

优化优先级评估结果的展示方式：

- 展示最终优先级评级（高、中、低）
- 显示主要决定因素
- 提供详细的评估理由
- 添加建议的后续步骤

需要修改的文件：
- `ai_evaluation.html`：优化结果展示页面
- `taskDetail.js`：更新showPriorityEvaluationDialog方法

## 执行计划

如果您同意这个修改方案，我将按照以下顺序实施更改：

1. 在`core.js`中添加数据存储层的新方法，支持目标和子步骤的修改、删除功能
2. 修改`taskDetail.js`添加目标和子步骤的编辑、删除功能
3. 更新`aiAssist.js`中的方法，添加用户描述参数和问卷生成功能
4. 修改`taskDetail.js`中的AI辅助方法，添加用户描述输入对话框
5. 实现基于问卷的优先级评估流程和界面
6. 测试所有新功能，确保它们正常工作

这个修改方案完整实现了您的所有需求，同时保持了应用的像素风格和整体设计一致性。
